apiVersion: v1
kind: ConfigMap
metadata:
  name: hive-config
  namespace: bigdata 
data:
  hive-site.xml: |
    <?xml version="1.0"?>
    <?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
    <configuration>
      # ket noi toi metastore, hadoop
      <property>
        <name>hive.server2.enable.doAs</name>
        <value>true</value>
      </property>    
      <property> 
        <name>hive.metastore.event.db.notification.api.auth</name> 
        <value>false</value>
      </property> 
      <property> 
        <name>hadoop.proxyuser.hive.hosts</name> 
        <value>*</value> 
      </property>  
      <property> 
        <name>hadoop.proxyuser.hive.groups</name> 
        <value>*</value> 
      </property>    
      #Tích hợp với Hive Metastore
      <property>
        <name>hive.metastore.uris</name>
        <value>thrift://metastore:9083</value>
      </property>
      <property>
        <name>javax.jdo.option.ConnectionURL</name>
        <value>jdbc:postgresql://citus-master.citus.svc.cluster.local:5432/metastore</value>
      </property>
      <property>
        <name>javax.jdo.option.ConnectionDriverName</name>
        <value>org.postgresql.Driver</value>
      </property>
      <property>
        <name>javax.jdo.option.ConnectionUserName</name>
        <value>smartconsultor</value>
      </property>
      <property>
        <name> javax.jdo.option.ConnectionPassword</name>
        <value>secret99</value>
      </property>
      # warehouse hdfs
      <property>
        <name>hive.metastore.warehouse.dir</name>
        <value>hdfs://namenode:8020/user/hive/warehouse</value>
      </property>
      # zookeeper disable
      <property>
        <name>hive.zookeeper.quorum</name>
        <value>zookeeper-0.zookeeper:2181,zookeeper-1.zookeeper:2181,zookeeper-2.zookeeper:2181</value>
      </property>
      # toi uu truy van tai hive
      <property>
          <name>hive.exec.parallel</name>
          <value>true</value>
          <description>Cho phép thực thi song song các tác vụ, giúp tăng tốc độ truy vấn.</description>
      </property>    
      <property>
          <name>hive.compactor.initiator.on</name>
          <value>true</value>
          <description>Kích hoạt compaction từ HiveServer.</description>
      </property>
      <property>
          <name>hive.compactor.worker.threads</name>
          <value>10</value>
          <description>Số lượng luồng để thực hiện công việc compaction trên HiveServer.</description>
      </property>
      <property>
          <name>hive.support.concurrency</name>
          <value>true</value>
          <description>Bật khả năng đồng thời (concurrency) trong HiveServer.</description>
      </property>
      #Cấu hình YARN cho Tez, Hiệu Suất tez, Cấu hình Cache cho tez
      <property>
        <name>hive.execution.engine</name>
        <value>tez</value>
      </property>
      <!--
      <property>
        <name>hive.tez.container.size</name>
        <value>2048</value>
        <description>The container size for each Tez task, in MB. This should match the YARN container size.</description>
      </property>
      <property>
        <name>hive.tez.cpu.vcores</name>
        <value>1</value>
        <description>The number of virtual cores allocated for each Tez container.</description>
      </property>
      <property>
        <name>hive.merge.tezfiles</name>
        <value>true</value>
        <description>Kích hoạt gộp các file nhỏ sau khi job Tez kết thúc.</description>
      </property>      
      <property>
          <name>hive.prewarm.enabled</name>
          <value>true</value>
          <description>Kích hoạt làm nóng trước container cho Tez.</description>
      </property>
      <property>
          <name>hive.prewarm.numcontainers</name>
          <value>1</value>
          <description>Số lượng container Tez được làm nóng trước.</description>
      </property>
      -->
    </configuration>
  core-site.xml: |
    <?xml version="1.0"?>
    <?xml-stylesheet type="text/xsl" href="configuration.xsl"?>
    <configuration>
      <property>
        <name>fs.defaultFS</name>
        <value>hdfs://namenode:8020</value>
      </property>    
    </configuration>
